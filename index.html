<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jeopardy Game</title>
  <style>
    body {
      background: #002244;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      max-width: 1000px;
      margin: 20px auto;
      gap: 2px;
    }

    .cell {
      background: #0055aa;
      padding: 20px;
      font-size: 20px;
      border: 2px solid #fff;
      cursor: pointer;
    }

    .cell.used {
      background: #003366;
      color: #aaa;
      pointer-events: none;
    }

    #scores {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px auto;
    }

    .score-box {
      background: #003366;
      margin: 5px;
      padding: 10px 20px;
      border: 2px solid #fff;
      border-radius: 8px;
      cursor: pointer;
    }

    #questionModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
      color: white;
      padding: 20px;
    }

    #questionModal button {
      margin: 10px;
      padding: 10px 20px;
      background: #0077cc;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    #questionModal button:hover {
      background: #3399ff;
    }

    #questionText {
      font-size: 24px;
      margin-bottom: 10px;
    }

    #answerContainer {
      font-size: 22px;
      color: yellow;
      margin-top: 10px;
      display: none;
    }

    #imageContainer img {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>Jeopardy!</h1>
  <div id="scores"></div>
  <div id="board">Loading...</div>

  <div id="questionModal">
    <div id="questionText"></div>
    <div id="imageContainer"></div>
    <button id="showAnswerBtn">Show Answer</button>
    <div id="answerContainer">Answer: <span id="answerText"></span></div>
    <div id="scoreButtons"></div>
    <button onclick="closeModal()">Close</button>
  </div>

  <script>
    const SHEET_ID = '1txasP_Te7O6BiyQvK88npPde_etEW9QnkOdAVzP7NKc';
    const API_KEY = 'AIzaSyDV4eHorJ4Rz8VJrnPuyXTpx30EcOc0ca4';
    const RANGE = 'Sheet1';

    let teams = [];

    function updateScores() {
      const container = document.getElementById('scores');
      container.innerHTML = '';
      teams.forEach((team, i) => {
        const box = document.createElement('div');
        box.className = 'score-box';
        box.textContent = `${team.name}: ${team.score}`;
        box.onclick = () => {
          const change = prompt(`Adjust score for ${team.name} (use + or -):`, 0);
          if (!isNaN(change)) {
            teams[i].score += parseInt(change);
            updateScores();
          }
        };
        container.appendChild(box);
      });
    }

    function closeModal() {
      document.getElementById('questionModal').style.display = 'none';
    }

    function showQuestion(question, answer, image, points, cell) {
      if (cell.classList.contains('used')) return;
      cell.classList.add('used');

      document.getElementById('questionText').textContent = question;

      const answerContainer = document.getElementById('answerContainer');
      const answerSpan = document.getElementById('answerText');
      answerSpan.textContent = answer;
      answerContainer.style.display = 'none';

      const imgContainer = document.getElementById('imageContainer');
      imgContainer.innerHTML = '';
      if (image && image.startsWith('http')) {
        const img = document.createElement('img');
        img.src = image;
        img.style.maxWidth = '100%';
        img.style.maxHeight = '200px';
        imgContainer.appendChild(img);
      }

      const showAnswerBtn = document.getElementById('showAnswerBtn');
      showAnswerBtn.style.display = 'inline-block';
      showAnswerBtn.onclick = () => {
        answerContainer.style.display = 'block';
        showAnswerBtn.style.display = 'none';
      };

      const scoreButtons = document.getElementById('scoreButtons');
      scoreButtons.innerHTML = '<p>Who answered correctly?</p>';
      teams.forEach((team, i) => {
        const btn = document.createElement('button');
        btn.textContent = team.name;
        btn.onclick = () => {
          teams[i].score += parseInt(points);
          updateScores();
          closeModal();
        };
        scoreButtons.appendChild(btn);
      });

      document.getElementById('questionModal').style.display = 'flex';
    }

    function createBoard(data) {
      const board = document.getElementById('board');
      board.innerHTML = '';

      const categories = {};
      data.forEach(item => {
        if (!categories[item.Category]) {
          categories[item.Category] = [];
        }
        categories[item.Category].push(item);
      });

      const categoryNames = Object.keys(categories).slice(0, 5);
      categoryNames.forEach(cat => {
        categories[cat].sort((a, b) => Number(a.Points) - Number(b.Points));
      });

      categoryNames.forEach(cat => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.textContent = cat;
        board.appendChild(cell);
      });

      const maxRows = Math.max(...Object.values(categories).map(qs => qs.length));
      for (let i = 0; i < maxRows; i++) {
        categoryNames.forEach(cat => {
          const questions = categories[cat];
          const cell = document.createElement('div');
          cell.className = 'cell';

          if (questions[i]) {
            const q = questions[i];
            cell.textContent = q.Points;
            cell.onclick = () => showQuestion(q.Question, q.Answer, q.Image, q.Points, cell);
          } else {
            cell.textContent = '';
            cell.style.background = '#003366';
            cell.style.cursor = 'default';
          }

          board.appendChild(cell);
        });
      }

      updateScores();
    }

    function fetchAndStart() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.values || data.values.length < 2) {
            throw new Error('No data found or insufficient data.');
          }
          const [headers, ...rows] = data.values;
          const formatted = rows.map(row => {
            const obj = {};
            headers.forEach((key, i) => obj[key] = row[i] || '');
            return obj;
          });
          createBoard(formatted);
        })
        .catch(err => {
          console.error('Google Sheets API error:', err);
          document.getElementById('board').textContent = 'Failed to load board.';
        });
    }

    window.onload = () => {
      let numTeams = parseInt(prompt('Enter number of teams:', 4));
      if (isNaN(numTeams) || numTeams < 1) numTeams = 4;

      teams = [];
      for (let i = 0; i < numTeams; i++) {
        let name = prompt(`Enter name for Team ${i + 1}:`, `Team ${i + 1}`);
        if (!name) name = `Team ${i + 1}`;
        teams.push({ name, score: 0 });
      }

      fetchAndStart();
    };
  </script>
</body>
</html>
